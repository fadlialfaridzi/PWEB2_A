<!DOCTYPE html>
<html lang="id">

<%- include('Component/headfix.ejs') %>

<body class="bg-gray-50">
<%- include('Component/navbarPencari.ejs') %>

     <!-- Menampilkan Pesan Sukses Jika Ada -->
        <% if (successMessage) { %>
            <div class="bg-green-500 text-white text-center p-4 mb-6 rounded-lg">
                <p><%= successMessage %></p>
            </div>
        <% } %>

    <!-- Kos Detail Section -->
    <section class="py-12 bg-white">
        <div class="max-w-[85rem] mx-auto px-4">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 text-center">Detail Kos</h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <!-- Kos Information -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="h-48 bg-gradient-to-r from-blue-400 to-blue-600 flex items-center justify-center">
                        <% if (kos.photos && kos.photos.length > 0) { %>
                            <img src="/uploads/<%= kos.photos[0] %>" alt="<%= kos.name %>" class="w-full h-full object-cover">
                        <% } else { %>
                            <i class="fas fa-home text-white text-6xl"></i>
                        <% } %>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 mt-4"><%= kos.name %></h3>
                    <p class="text-gray-600 mb-2"><i class="fas fa-map-marker-alt text-blue-500 mr-2"></i><%= kos.address %></p>
                    <p class="text-2xl font-bold text-blue-600 mb-3">Rp <%= kos.price %> / <%= kos.payment_type %></p>
                    <p class="text-gray-600 mb-4"><%= kos.description %></p>

                    <!-- Facilities List -->
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Fasilitas</h4>
                    <div class="flex flex-wrap gap-2">
                        <% facilities.forEach(facility => { %>
                            <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full"><%= facility.fasilitas %></span>
                        <% }); %>
                    </div>
                    <!-- Tipe Kos -->
                    <p class="mt-5 text-sm uppercase text-gray-600">Tipe:  <span class="font-semibold text-blue-600"><%= kos.tipe_kos %></span></p>
                    
                    <!-- Pesan Sekarang Button -->
                    <div class="mt-10 flex justify-between">
                        <!-- Jika booking berhasil (successMessage ada) tampilkan tombol Batalkan Pesanan -->
                            <!-- Tombol Batalkan Pesanan -->
                            <% if (successMessage) { %>
                                <form action="/batalkanPesanan" method="POST">
                                    <input type="hidden" name="kosId" value="<%= kos.id %>">
                                    <button type="submit" class="text-center bg-red-500 text-white py-2 px-6 rounded-lg hover:bg-red-700 transition-all">
                                        Batalkan Pesanan
                                    </button>
                                </form>
                            <% } else { %>
                                <!-- Tombol Pesan Sekarang jika belum ada pesan sukses -->
                                <a href="/bookingPage/<%= kos.id %>?bookingDate=<%= new Date().toISOString().split('T')[0] %>" id="bookingButton" class="text-center bg-blue-500 text-white py-2 px-6 rounded-lg hover:bg-blue-700 transition-all">
                                    Pesan Sekarang
                                </a>
                            <% } %>
                        <a href="#bookingModal" id="addFavoriteButton" class="text-center bg-pink-400 text-white py-2 px-6 rounded-lg hover:bg-pink-700 transition-all">
                            Tambahkan Favorit
                        </a>
                    </div>
                </div>

                <!-- Google Maps Section -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold">Lokasi Kos</h2>
                    <div id="map" style="height: 400px;"></div> <!-- Container for Google Maps -->
                </div>
                </div>

            </div>
        </div>
    </section>
    

    <%- include('Component/footer.ejs') %>

    <script>
        // Inisialisasi Google Maps
        function initMap() {
            const location = {
                lat: <%= kos.latitude ? kos.latitude : 'null' %>,  // Set latitude from database
                lng: <%= kos.longitude ? kos.longitude : 'null' %>  // Set longitude from database
            };

            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,  // Set the zoom level
                center: location,  // Set the center of the map based on latitude and longitude
            });

            // Add marker to the map at the specified location
            new google.maps.Marker({
                position: location,
                map: map,
                title: "<%= kos.name %>"  // Optional: Set a title for the marker (e.g., the name of the kos)
            });
        }

        // Menjalankan peta setelah halaman dimuat
        window.initMap = initMap;
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBx9UJ53-dhtrJQ0d31MAkwXeNozDcrWOA&callback=initMap" async></script>
</body>

</html>
