<!DOCTYPE html>
<html lang="id">

<%- include('Component/headfix.ejs') %>

<body class="bg-gray-50">
<%- include('Component/navbarPencari.ejs') %>

    <!-- Search Results Header -->
    <section class="py-8 mt-8">
        <div class="max-w-[85rem] mx-auto px-4">
            <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">
                            <i class="fas fa-search text-blue-600 mr-2"></i>
                            Hasil Pencarian
                        </h1>
                        <p class="text-gray-600">
                            Ditemukan <span class="font-semibold text-blue-600"><%= totalResults %></span> kost yang sesuai dengan kriteria pencarian
                        </p>
                    </div>
                    <a href="/indexPencariKos" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-200 flex items-center space-x-2 mt-4 md:mt-0">
                        <i class="fas fa-arrow-left"></i>
                        <span>Kembali ke Pencarian</span>
                    </a>
                </div>

                <!-- Applied Filters -->
                <% if (searchParams && (searchParams.tipe_kos || searchParams.payment_type || searchParams.price_range || searchParams.facilities)) { %>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Filter yang Diterapkan:</h3>
                        <div class="flex flex-wrap gap-2">
                            <% if (searchParams.tipe_kos) { %>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                    <i class="fas fa-home mr-1"></i>
                                    Tipe: <%= searchParams.tipe_kos === 'putra' ? 'Putra' : 'Putri' %>
                                </span>
                            <% } %>
                            <% if (searchParams.payment_type) { %>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                    <i class="fas fa-credit-card mr-1"></i>
                                    Pembayaran: <%= searchParams.payment_type === 'perbulan' ? 'Per Bulan' : 'Per Tahun' %>
                                </span>
                            <% } %>
                            <% if (searchParams.price_range) { %>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                    <i class="fas fa-money-bill mr-1"></i>
                                    Harga: 
                                    <% if (searchParams.price_range === '1') { %>Rp 100.000 - 500.000<% } %>
                                    <% if (searchParams.price_range === '2') { %>Rp 500.000 - 1.000.000<% } %>
                                    <% if (searchParams.price_range === '3') { %>Rp 1.000.000 - 2.000.000<% } %>
                                    <% if (searchParams.price_range === '4') { %>Rp 2.000.000 - 5.000.000<% } %>
                                    <% if (searchParams.price_range === '5') { %>Rp > 5.000.000<% } %>
                                </span>
                            <% } %>
                            <% if (searchParams.facilities && searchParams.facilities.length > 0) { %>
                                <% 
                                // Ensure facilities is always an array
                                const facilitiesArray = Array.isArray(searchParams.facilities) ? searchParams.facilities : [searchParams.facilities];
                                %>
                                <% facilitiesArray.forEach(facility => { %>
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                        <i class="fas fa-check mr-1"></i>
                                        <%= facility %>
                                    </span>
                                <% }); %>
                            <% } %>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </section>

    <!-- Search Results -->
    <section class="py-8">
        <div class="max-w-[85rem] mx-auto px-4">
            <% if (kos && kos.length > 0) { %>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <% kos.forEach((kosItem) => { %>
                        <a href="/detailkospencari/<%= kosItem.id %>" class="block w-full">
                            <div class="kos-card bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
                                <div class="h-48 bg-gradient-to-r from-blue-400 to-blue-600 flex items-center justify-center">
                                    <% if (kosItem.photos && kosItem.photos.length > 0) { %>
                                        <img src="/uploads/<%= kosItem.photos[0] %>" alt="<%= kosItem.name %>" class="w-full h-full object-cover">
                                    <% } else { %>
                                        <i class="fas fa-home text-white text-6xl"></i>
                                    <% } %>
                                </div>
                                <div class="p-6">
                                    <h4 class="font-bold text-xl text-gray-800 mb-2"><%= kosItem.name %></h4>
                                    <div class="mb-4">
                                        <p class="text-gray-600 mb-2 flex items-center">
                                            <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>
                                            <%= kosItem.address %>
                                        </p>
                                    </div>
                                    <p class="text-2xl font-bold text-blue-600 mb-3">Rp <%= kosItem.price %> / <%= kosItem.payment_type %></p>
                                    
                                    <div class="flex flex-wrap gap-1 mb-4">
                                        <% if (kosItem.facilities && kosItem.facilities.length > 0) { %>
                                            <% kosItem.facilities.slice(0, 3).forEach(facility => { %>
                                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full"><%= facility %></span>
                                            <% }); %>
                                            <% if (kosItem.facilities.length > 3) { %>
                                                <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full">+<%= kosItem.facilities.length - 3 %> lagi</span>
                                            <% } %>
                                        <% } else { %>
                                            <span class="text-gray-600 text-xs">No facilities available</span>
                                        <% } %>
                                    </div>

                                    <!-- Tipe Kos -->
                                    <p class="text-sm uppercase text-gray-600 mb-3">Tipe: <span class="font-semibold text-blue-600"><%= kosItem.tipe_kos %></span></p>

                                    <!-- Rating & Jumlah User -->
                                    <div class="flex items-center gap-2 mb-3">
                                        <span class="flex items-center">
                                            <% for(let i = 1; i <= 5; i++) { %>
                                                <i class="fas fa-star <%= i <= Math.round(parseFloat(kosItem.avg_rating || 0)) ? 'text-yellow-400' : 'text-gray-400' %>"></i>
                                            <% } %>
                                        </span>
                                        <span class="text-sm text-gray-600 ml-2">
                                            <%= kosItem.avg_rating || '0.0' %> / 5
                                            (<%= kosItem.total_ratings || 0 %> rating<%= (kosItem.total_ratings || 0) == 1 ? '' : 's' %>)
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    <% }); %>
                </div>
            <% } else { %>
                <!-- No Results Found -->
                <div class="text-center py-12">
                    <div class="bg-white p-8 rounded-xl shadow-lg max-w-md mx-auto">
                        <i class="fas fa-search text-gray-400 text-6xl mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Tidak Ada Hasil</h3>
                        <p class="text-gray-600 mb-6">
                            Maaf, tidak ada kost yang sesuai dengan kriteria pencarian Anda. 
                            Coba ubah filter pencarian atau lihat semua kost yang tersedia.
                        </p>
                        <div class="flex flex-col sm:flex-row gap-3 justify-center">
                            <a href="/indexPencariKos" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-200">
                                Ubah Pencarian
                            </a>
                            <a href="/" class="border-2 border-blue-400 text-blue-600 hover:bg-blue-50 font-semibold py-2 px-4 rounded-lg transition-all duration-200">
                                Lihat Semua Kost
                            </a>
                        </div>
                    </div>
                </div>
            <% } %>
        </div>
    </section>

    <!-- Back to Top Button -->
    <button id="backToTop" class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-200 opacity-0 invisible">
        <i class="fas fa-arrow-up"></i>
    </button>

    <%- include('Component/footer.ejs') %>

    <script>
        // Back to top functionality
        const backToTopButton = document.getElementById('backToTop');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopButton.classList.remove('opacity-0', 'invisible');
                backToTopButton.classList.add('opacity-100', 'visible');
            } else {
                backToTopButton.classList.add('opacity-0', 'invisible');
                backToTopButton.classList.remove('opacity-100', 'visible');
            }
        });
        
        backToTopButton.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // JavaScript to toggle the dropdown visibility
        const dropdownButton = document.getElementById('userDropdownButton');
        const dropdownMenu = document.getElementById('userDropdownMenu');

        if (dropdownButton && dropdownMenu) {
            dropdownButton.addEventListener('click', () => {
                dropdownMenu.classList.toggle('hidden');
            });

            // Optionally, close the dropdown if clicked outside
            document.addEventListener('click', (event) => {
                if (!dropdownButton.contains(event.target) && !dropdownMenu.contains(event.target)) {
                    dropdownMenu.classList.add('hidden');
                }
            });
        }
    </script>
</body>
</html> 