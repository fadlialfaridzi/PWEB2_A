<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Kos</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/preline@1.0.0/dist/preline.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/preline@1.0.0/dist/preline.min.js"></script>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBx9UJ53-dhtrJQ0d31MAkwXeNozDcrWOA&callback=initMap&v=weekly" async></script>

    <style>
        /* Set the size of the map */
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <!-- Navbar -->
<main class="flex-grow">
  <header class="flex flex-wrap sm:justify-start sm:flex-nowrap w-full bg-gradient-to-r from-blue-800 via-blue-600 to-blue-400 text-sm py-3">
    <nav class="max-w-[85rem] w-full mx-auto px-4 flex flex-wrap basis-full items-center justify-between">
      <a class="sm:order-1 flex-none text-xl font-semibold text-white" href="#">KosAnd</a>
      <div class="sm:order-3 flex items-center gap-x-2">
        <% if (user) { %>
          <div class="text-white relative">
            <button type="button" class="flex items-center gap-x-2 border-2 border-blue-400 rounded-full px-5 py-1 shadow-lg" id="userDropdownButton">
              <img src="/images/user.png" alt="User Avatar" class="w-8 h-8 rounded-full bg-white" />
              <span class="uppercase"><%= user.name %></span>
            </button>
            <div id="userDropdownMenu" class="absolute right-0 w-40 mt-2 bg-white shadow-md rounded-lg hidden">
              <ul class="text-sm text-gray-700">
                <li class="block px-4 py-2">User ID: <%= user.id %></li>
                <li><a href="/profile" class="block px-4 py-2">Profile</a></li>
                <li>
                  <a href="/logout" class="block px-4 py-2 text-red-500">Logout</a>
                </li>
              </ul>
            </div>
          </div>
        <% } %>
      </div>
    </nav>
  </header>
    <form class="mr-72 ml-72 mt-8 mb-8 bg-white rounded-2xl px-52 shadow-lg" action="/editKos/<%= kos.id %>" method="POST" enctype="multipart/form-data">
        <h1 class="text-3xl font-semibold pt-4 mb-6 text-center">Edit Kos</h1>
        <div class="mb-4">
            <label for="name" class="block text-sm font-medium text-gray-700">Nama Kos</label>
            <input type="text" name="name" id="name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md" value="<%= kos.name %>" required />
        </div>

        <div class="mb-4">
            <label for="price" class="block text-sm font-medium text-gray-700">Harga</label>
            <input type="number" name="price" id="price" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md" value="<%= kos.price %>" required />
        </div>

        <div class="mb-4">
            <label for="paymentType" class="block text-sm font-medium text-gray-700">Tipe Pembayaran</label>
            <select name="paymentType" id="paymentType" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                <option value="perbulan" <%= kos.payment_type === 'perbulan' ? 'selected' : '' %>>Perbulan</option>
                <option value="pertahun" <%= kos.payment_type === 'pertahun' ? 'selected' : '' %>>Pertahun</option>
            </select>
        </div>

        <div class="mb-4">
            <label for="address" class="block text-sm font-medium text-gray-700">Alamat</label>
            <input type="text" name="address" id="address" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md" value="<%= kos.address %>" required />
        </div>

        <!-- Google Map Section -->
        <div class="mb-4">
            <label for="map" class="block text-sm font-medium text-gray-700">Pilih Lokasi di Peta</label>
            <div id="map"></div>
        </div>

        <!-- Hidden Latitude and Longitude inputs -->
        <input type="hidden" name="latitude" id="latitude" value="<%= kos.latitude %>" />
        <input type="hidden" name="longitude" id="longitude" value="<%= kos.longitude %>" />

        <div class="mb-4">
            <label for="description" class="block text-sm font-medium text-gray-700">Deskripsi</label>
            <textarea name="description" id="description" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md" required><%= kos.description %></textarea>
        </div>

       <!-- Fasilitas Section -->
        <div class="mb-6 border-2 p-4">
            <label for="facilities" class="mb-4 block text-sm font-medium text-gray-700">Fasilitas Kos</label>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                <% const fasilitas = ['Wifi', 'Dapur', 'Token per Kemar', 'Lemari', 'AC', 'Ruang Tamu', 'Air Gratis', 'Meja Belajar', 'Kamar Mandi Dalam', 'CCTV', 'Kasur'] %>
                <% const selectedFacilities = kos.facilities || [] %> <!-- Pastikan kos.facilities adalah array -->
                <% fasilitas.forEach(facility => { %>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" name="facilities[]" value="<%= facility %>" id="<%= facility %>"
                            <%= selectedFacilities.includes(facility) ? 'checked' : '' %>
                            class="form-checkbox h-5 w-5 text-blue-600"
                        />
                        <label for="<%= facility %>" class="text-sm text-gray-700"><%= facility %></label>
                    </div>
                <% }) %>
            </div>
        </div>


        <div class="mb-4 border-2 p-4">
            <label for="photos" class="block text-sm font-medium text-gray-700">Foto Kos</label>
            <input type="file" name="photos" accept="image/*" class="form-control mt-1" />
            <small>Foto opsional untuk diubah</small>
        </div>
        <!-- Tombol Back disebelah kanan -->
        <div class="flex justify-end">
            <a href="/indexPemilikKos" class="mb-4 bg-blue-500 font-bold text-white px-4 py-2 rounded hover:bg-gray-700">
                Back
            </a>
             <button type="submit" class="ml-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-5">
            Update Kos
        </button>
        </div>
    </form>
    <!-- Footer -->
    <footer class="bg-gray-200 text-gray-500 py-4 mt-8">
        <div class="max-w-[85rem] w-full mx-auto text-center">
            <p class="text-sm">Â© 2025 Pemrograman Web A - Kelompok 2. All rights reserved.</p>
        </div>
    </footer>
</main>
    <script>
        let map, marker;

        function initMap() {
            const defaultLat = <%= kos.latitude %> || -6.200000;
            const defaultLng = <%= kos.longitude %> || 106.816666;

            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: defaultLat, lng: defaultLng },
                zoom: 15,
            });

            marker = new google.maps.Marker({
                position: { lat: defaultLat, lng: defaultLng },
                map: map,
                draggable: true,
            });

            google.maps.event.addListener(map, "click", function (event) {
                const lat = event.latLng.lat();
                const lng = event.latLng.lng();
                marker.setPosition(event.latLng);

                document.getElementById("latitude").value = lat;
                document.getElementById("longitude").value = lng;
            });

            google.maps.event.addListener(marker, "dragend", function () {
                const lat = marker.getPosition().lat();
                const lng = marker.getPosition().lng();

                document.getElementById("latitude").value = lat;
                document.getElementById("longitude").value = lng;
            });
        }
        window.initMap = initMap;
    </script>
</body>

</html>
