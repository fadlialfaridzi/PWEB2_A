<!DOCTYPE html>
<html lang="id">
<%- include('Component/headfix.ejs') %>
<body class="bg-gray-50">
<%- include('Component/navbarPencari.ejs') %>

    <!-- Map Section -->
    <section id="map-section" class="py-12">
        <div class="max-w-[85rem] mx-auto px-4">
            <div class="text-center mb-12">
                <h3 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Peta Kost Tersedia</h3>
                <p class="text-lg text-gray-600">Lihat kos yang tersedia di sekitar Universitas Andalas</p>
            </div>
            <!-- Google Map -->
            <div id="map" class="w-full h-96 rounded-xl shadow-lg border-2"></div>
        </div>
    </section>

    <%- include('Component/footer.ejs') %>

    <script>
    function initMap() {
        const center = { lat: -0.914518, lng: 100.459526 };
        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 12,
            center: center,
        });

        <% if (kos && kos.length > 0) { %>
            <% kos.forEach(function(kosItem) { %>
                <% if (kosItem.status === 'available') { %> <!-- Kondisi untuk menampilkan marker hanya jika status adalah 'available' -->
                    (function() {
                        const marker = new google.maps.Marker({
                            position: { lat: <%= kosItem.latitude %>, lng: <%= kosItem.longitude %> },
                            map: map,
                            title: "<%= kosItem.name %>"
                        });

                        const infoWindow = new google.maps.InfoWindow({
                            content: `
                                <div class="p-3">
                                    <h3 class="font-bold"> <a href="/detailkospencari/<%= kosItem.id %>" class="block w-full"><%= kosItem.name %></a></h3>
                                    <p>Harga: Rp <%= kosItem.price %> / <%= kosItem.payment_type === 'perbulan' ? 'bulan' : 'tahun' %></p>
                                    <p>Alamat: <%= kosItem.address %></p>
                                    <% if (kosItem.description) { %>
                                        <p class="mt-2">Deskripsi: <%= kosItem.description %></p>
                                    <% } %>
                                </div>
                            `
                        });

                        marker.addListener("click", () => {
                            infoWindow.open(map, marker);
                        });
                    })();
                <% } %> <!-- End of available status check -->
            <% }); %>
        <% } else { %>
            console.log("No kos data available");
        <% } %>
    }
    window.initMap = initMap;
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBx9UJ53-dhtrJQ0d31MAkwXeNozDcrWOA&callback=initMap" async defer></script>

</body>
</html>
